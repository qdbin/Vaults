## Spring有几种事务传播行为？

- 我按照自己的理解将7种事务传播行为分成了3类，协同，独立和约束，分别……

- 面试时可按协同、独立、约束三派回答，逻辑更清晰，避免死记硬背单词。

#### **一、协同派（共存共享）**

1. REQUIRED（默认）

   - 特性：

     如果当前有事务，加入当前事务

     ；无事务则新建。

   - 场景：适合需要整体提交 / 回滚的业务，如订单与库存操作。

   - 示例：下单减库存必须在同一事务中，一荣俱荣，一损俱损。

2. SUPPORTS

   - 特性：

     有事务则加入，无事务则非事务执行。

   - 场景：适合查询操作，如余额查询、资料检索。

3. NESTED

   - 特性：

     在父事务中创建子事务

     ，子事务可单独回滚，但父事务失败时子事务也回滚。

   - 场景：复杂流程中允许局部失败，如订单拆分子订单。

#### **二、独立派（不受影响）**

1. REQUIRES_NEW
   - 特性：无论当前有无事务，都新建独立事务，外部事务挂起。
   - 场景：日志记录，主业务失败不影响日志提交。
2. NOT_SUPPORTED
   - 特性：不使用事务，挂起当前事务。
   - 场景：无需事务控制的查询操作。

#### **三、约束派（立场鲜明）**

1. MANDATORY
   - 特性：强制必须在事务中执行，无事务则报错。
   - 场景：关键业务链必须统一提交。
2. NEVER
   - 特性：禁止在事务中执行，有事务则报错。
   - 场景：不允许事务的操作。

### **七种行为总结**

| 分类   | 行为类型      | 说明                         |
| ------ | ------------- | ---------------------------- |
| 协同派 | REQUIRED      | 默认，加入当前事务或新建     |
|        | SUPPORTS      | 支持事务，无事务则非事务执行 |
|        | NESTED        | 嵌套事务，子事务可独立回滚   |
| 独立派 | REQUIRES_NEW  | 新建事务，独立于外部事务     |
|        | NOT_SUPPORTED | 非事务执行，挂起当前事务     |
| 约束派 | MANDATORY     | 必须在事务中执行，否则报错   |
|        | NEVER         | 禁止事务，有事务则报错       |

